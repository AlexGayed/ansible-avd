{# Tenant virtual source NAT vrfs #}
{% set leaf_tenant_virtual_source_nat = namespace() %}
{% for tenant in tenants | natural_sort if tenant in leaf.filter_tenants or "all" in leaf.filter_tenants %}
{%     if tenants[tenant].vrfs is defined %}
{%         for vrf in tenants[tenant].vrfs | natural_sort if vrf in leaf.vrfs %}
{%             if loop.first %}
## {{ tenant }} ##
{%             endif %}
  {{ vrf }}:
    ip_address: {{ tenants[tenant].vrfs[vrf].loopback_range | ipaddr('network') | ipmath(leaf.id + spine.nodes | length) }}
{%         endfor %}
{%    endif %}
{% endfor %}