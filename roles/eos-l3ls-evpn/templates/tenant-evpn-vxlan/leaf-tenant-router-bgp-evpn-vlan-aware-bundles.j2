{# Leaf tenant router bgp evpn configuration - MAC-VRF VLAN Aware bundles #}
{% if vxlan_vlan_aware_bundles == true %}
{%     for tenant in tenants | natural_sort if tenant in leaf.filter_tenants or "all" in leaf.filter_tenants %}
## {{ tenant }} ##
{%         for vrf in tenants[tenant].vrfs | natural_sort if vrf in leaf.vrfs %}
    {{ vrf }}:
      rd: "{{ overlay_loopback_network_summary | ipaddr('network') | ipmath(leaf.id + spine.nodes | length) }}:{{ vxlan_vni_base * tenants[tenant].id + 5000 + tenants[tenant].vrfs[vrf].id }}"
      route_targets:
        both:
          asn: "{{ vxlan_vni_base * tenants[tenant].id + 5000 + tenants[tenant].vrfs[vrf].id }}:{{ vxlan_vni_base * tenants[tenant].id + 5000 + tenants[tenant].vrfs[vrf].id }}"
      redistribute_routes:
        - learned
{%             set vlan_range = [] %}
{%             for svi in tenants[tenant].vrfs[vrf].svis | natural_sort %}
{%                 do vlan_range.append( svi ) %}
{%             endfor %}
      vlan: {{ vlan_range | list_compress }}
{%         endfor %}
{%     endfor %}
{% endif %}