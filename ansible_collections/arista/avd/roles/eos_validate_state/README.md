# Ansible Role: eos_validate_state

**Table of Contents:**

- [Ansible Role: eos_validate_state](#ansible-role-eos_validate_state)
  - [Overview](#overview)
  - [Role Inputs and Outputs](#role-inputs-and-outputs)
  - [Requirements](#requirements)
  - [Example PLaybook](#example-playbook)
  - [Input example](#input-example)
    - [inventory/inventory.ini](#inventoryinventoryini)
    - [inventory/group_vars/DC1.yml](#inventorygroup_varsdc1yml)
    - [inventory/intended/structured_configs/switch1.yml](#inventoryintendedstructured_configsswitch1yml)
  - [Usage example](#usage-example)
  - [License](#license)

## Overview

**eos_validate_state** is role leveraged to validate operational states of Arista EOS devices.

**eos_validate_state** role:

- consumes structured EOS configuration file, the same input as the role [eos_cli_config_gen](ansible_collections/arista/avd/roles/eos_cli_config_gen). This input is considered the source of truth (the desired state).
- It connects to EOS devices to collects operational states (actual state). So this role requires an access to the configured devices.
- Compares the actual states against the desired state.

## Role Inputs and Outputs

**Inputs:**

- Device structured configuration generated by abstration role.

**Outputs:**

- Ansible command line results for each task and summary.

**Tasks:**

1. Include device structured configuration.
2. Display devices model and EOS release.
3. Validate environment (fan status).
4. Validate environment (power supplies status).
5. Validate environment (temperature).
6. Validate transceivers manufacturer.
7. Validate last reload cause.
8. Validate NTP status.
9. Validate interfaces admin status.
10. Validate interfaces op status.
11. Validate LLDP topology.
12. Validate MLAG status.
13. Validate IP reachability (on directly connected interfaces).
14. Validate ArBGP is configured and operating.
15. Validate BGP sessions state.

## Requirements

Requirements are located here: [avd-requirements](../../README.md#Requirements)

## Example PLaybook

```yaml
---
- name: validate states on EOS devices
  hosts: DC1
  connection: httpapi
  gather_facts: false
  collections:
    - arista.avd

  tasks:

    - name: validate states on EOS devices
      import_role:
         name: arista.avd.eos_validate_state
```

## Input example

### inventory/inventory.ini

```yaml
---
all:
  children:
    DC1:
      children:
        DC1_FABRIC:
          children:
            DC1_SPINES:
              hosts:
                switch2:
                  ansible_host: 10.83.28.190
            DC1_L3LEAFS:
              children:
                DC1_LEAF1:
                  hosts:
                    switch1:
                      ansible_host: 10.83.28.216
                DC1_LEAF2:
                  hosts:
                    switch3:
                      ansible_host: 10.83.28.191
```

### inventory/group_vars/DC1.yml

```yaml
ansible_user: 'arista'
ansible_password: 'arista'
ansible_network_os: eos
ansible_become: yes
ansible_become_method: enable

validation_mode_loose: true
```

### inventory/intended/structured_configs/switch1.yml

```yaml
router_bgp:
  neighbors:
    10.10.10.1:
      remote_as: 65002
    10.10.10.3:
      remote_as: 65003

ethernet_interfaces:
  Ethernet2:
    peer: switch3
    peer_interface: Ethernet4
    ip_address: 10.10.10.2/31
    type: routed
  Ethernet5:
    peer: switch2
    peer_interface: Ethernet5
    ip_address: 10.10.10.0/31
    type: routed

mlag_configuration:
  domain_id: MLAG12
  local_interface: Vlan4094
  peer_address: 172.16.12.1
  peer_link: Port-Channel10
  reload_delay_mlag: 300
  reload_delay_non_mlag: 330

ntp_server:
  local_interface:
    vrf: MGMT
    interface: Management1
  nodes:
    - 0.fr.pool.ntp.org
    - 1.fr.pool.ntp.org

dns_domain: lab.local
```

## Usage example

```shell
ansible-playbook playbooks/pb_validate_yml --skip-tags "hardware, optional" --inventory inventory/inventory.yml
```

## License

Project is published under [Apache 2.0 License](../../LICENSE)
